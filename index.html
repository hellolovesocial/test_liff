<!DOCTYPE html>
<html lang="ja">
  <!-- <html lang="ja" prefix="og: http://ogp.me/ns#"> -->
  <head>
    <title>Massage mina test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="MINAKO TEST LIFF">
    <meta property="og:type" content="website">
    <meta property="og:description" content="minakoのテストLIFF">
    <meta property="og:url" content="https://liff.line.me/1653746756-2Lrl3yld">
    <meta property="og:site_name" content="MINAKO SITE NAME">
    <meta property="og:image" content="https://www.soupdesign.co.jp/wordpress/wp-content/uploads/sample_logo.jpg">
    <style>
      .btn {
        height: 40px;
        border: #DDD;
        box-shadow: 0 4px 4px #BBB;
      }
      .flex {
        margin-bottom: 10px;
        width: 100%;
        text-align:center;
      }
      .img {
        border-radius: 50%;
        width: 100px;
        height: 100px;
      }
      .h1 {
        text-align:center; 
        width: 100%;
      }
      .h2 {
        text-align:center;
        width: 100%;
      }
    </style>
    <!-- Load LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  </head>
  <body>
    <div class="flex">
      <h1>Massage mina</h1>
      <h2>はじめまして</h2>
    </div>
    <div class="flex">
      <input type="date" name="tomorrow" id="tomorrow">
      <button class="btn" id="sendMessage">施術師を確認</button>
    </div>
    <div class="flex">
      <p>追加したいメッセージを入れてね</p>
      <input type="text" id="message" name="message" size="30" placeholder="メッセージを入力">
      </br>
      <button class="btn" id="shareFriends">友だちにシェア</button>
    </div>
    <div class="flex">
      <button class="btn" id="closeWindowButton">close</button>
    </div>
    </br>
    <div class="flex">
      <button class="btn" id="showProfile">プロフィール情報を確認</button></br>
      <img id="profile_img" class="img" src=""/>
      <p id="profile_name"></p>
      <p id="profile_status"></p>
    </div>
  </body>
  <script>
    // My LIFF ID
    const liffId = "1653746756-2Lrl3yld"
    // Text I want to send
    const text = "予約"
    // Containers displaying profile information
    const Name = document.getElementById('profile_name');
    const Img = document.getElementById("profile_img");
    const Status = document.getElementById("profile_status");

    // Callbacks being called after clicking the button
    function showProfile() {
      liff.getProfile()
      .then(profile => {
        const name = profile.displayName;
        const pic = profile.pictureUrl;
        const status = profile.statusMessage;
        console.log('name', name);
        console.log('pic', pic);
        console.log('status', status);
        Name.innerHTML = name;
        Status.innerHTML = status;
        Img.src = pic;
      })
      .catch((err) => {
        console.log('error', err);
      });
    }

    function sendMessage() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate()+1); //翌日の日付を取得
      const yyyy = tomorrow.getFullYear();
      const mm = ("0"+(tomorrow.getMonth()+1)).slice(-2);
      const dd = ("0"+tomorrow.getDate()).slice(-2);
      console.log('yyyy', yyyy);
      console.log('mm', mm);
      console.log('dd', dd);
      const val = document.getElementById("tomorrow").value=yyyy+'-'+mm+'-'+dd;
      console.log('val', val);
      liff.sendMessages(
        [{
          type: "text",
          text: val + "に予約を希望する"
        }]
        ).then(function() {
            window.alert('情報が送られました。トーク画面に戻りましょう');
        }).catch(function(error) {
            window.alert('エラーが起こりました。：' + error);
        });
    }

    function shareFriends() {
      const message = document.getElementById("message").value
      console.log('message', message);
      if (liff.isApiAvailable('shareTargetPicker')){
        liff.shareTargetPicker(
          [{ type: 'text', text:  message + 'https://liff.line.me/1653746756-2Lrl3yld'}]
        ).then(function() {
          window.alert('シェアしました');
        }).catch(function(error) {
          window.alert('シェア機能でエラーが起こりました：'+ error);
        });
      };
    }

    function closeWindow() {
      if (!liff.isInClient()) {
          sendAlertIfNotInClient();
      } else {
          liff.closeWindow();
      }
    }

    liff.init({liffId}).then(() => {
      if (liff.isLoggedIn()) {
      }
      else{
        liff.login();
      }
    })

    // Declaration to bind buttons and callbacks
    document.querySelector("#showProfile").addEventListener("click", showProfile)
    document.querySelector("#sendMessage").addEventListener("click", sendMessage)
    document.querySelector("#shareFriends").addEventListener("click", shareFriends)
    document.getElementById('closeWindowButton').addEventListener('click', closeWindow)

  </script>
</html>
